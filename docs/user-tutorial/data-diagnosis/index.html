<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.1">
<link rel="alternate" type="application/rss+xml" href="/superbenchmark/blog/rss.xml" title="SuperBench Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/superbenchmark/blog/atom.xml" title="SuperBench Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="SuperBench" href="/superbenchmark/opensearch.xml"><title data-react-helmet="true">Data Diagnosis | SuperBench</title><meta data-react-helmet="true" property="og:url" content="https://microsoft.github.io/superbenchmark/docs/user-tutorial/data-diagnosis"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Data Diagnosis | SuperBench"><meta data-react-helmet="true" name="description" content="Introduction"><meta data-react-helmet="true" property="og:description" content="Introduction"><link data-react-helmet="true" rel="shortcut icon" href="/superbenchmark/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://microsoft.github.io/superbenchmark/docs/user-tutorial/data-diagnosis"><link data-react-helmet="true" rel="alternate" href="https://microsoft.github.io/superbenchmark/docs/user-tutorial/data-diagnosis" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://microsoft.github.io/superbenchmark/docs/user-tutorial/data-diagnosis" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/superbenchmark/assets/css/styles.081fa1d1.css">
<link rel="preload" href="/superbenchmark/assets/js/runtime~main.1636966a.js" as="script">
<link rel="preload" href="/superbenchmark/assets/js/main.fa6a49aa.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP shadow--md">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/superbenchmark/"><img src="/superbenchmark/img/logo.svg" alt="Docusaurus Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/superbenchmark/img/logo.svg" alt="Docusaurus Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">SuperBench</b></a><a class="navbar__item navbar__link navbar__link--active" href="/superbenchmark/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/superbenchmark/docs/cli">API</a><a class="navbar__item navbar__link" href="/superbenchmark/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/microsoft/superbenchmark" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_xXbB"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/superbenchmark/"><img src="/superbenchmark/img/logo.svg" alt="Docusaurus Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/superbenchmark/img/logo.svg" alt="Docusaurus Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">SuperBench</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/superbenchmark/docs/introduction">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/superbenchmark/docs/cli">API</a></li><li class="menu__list-item"><a class="menu__link" href="/superbenchmark/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/microsoft/superbenchmark" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/superbenchmark/docs/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/superbenchmark/docs/getting-started/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/superbenchmark/docs/getting-started/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/superbenchmark/docs/getting-started/run-superbench">Run SuperBench</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">User Tutorial</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Benchmarks</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/superbenchmark/docs/user-tutorial/benchmarks/micro-benchmarks">Micro Benchmarks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/superbenchmark/docs/user-tutorial/benchmarks/model-benchmarks">Model Benchmarks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/superbenchmark/docs/user-tutorial/benchmarks/docker-benchmarks">Docker Benchmarks</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/superbenchmark/docs/user-tutorial/system-config">System Config Info</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/superbenchmark/docs/user-tutorial/data-diagnosis">Data Diagnosis</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/superbenchmark/docs/user-tutorial/monitor">Monitor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/superbenchmark/docs/user-tutorial/container-images">Container Images</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Developer Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/superbenchmark/docs/developer-guides/development">Development</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/superbenchmark/docs/developer-guides/using-docker">Using Docker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/superbenchmark/docs/developer-guides/contributing">Contributing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Design Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/superbenchmark/docs/design-docs/overview">Superbench Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/superbenchmark/docs/design-docs/benchmarks">Benchmarks Design</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">Data Diagnosis</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>This tool is to filter the defective machines automatically from thousands of benchmarking results according to rules defined in <strong>rule file</strong>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="usage"></a>Usage<a class="hash-link" href="#usage" title="Direct link to heading">#</a></h2><ol><li><p><a href="/superbenchmark/docs/getting-started/installation">Install SuperBench</a> on the local machine.</p></li><li><p>Prepare the raw data, rule file, baseline file under current path or somewhere on the local machine.</p></li><li><p>After installing the Superbnech and the files are ready, you can start to filter the defective machines automatically using  <code>sb result diagnosis</code> command. The detailed command can be found from <a href="/superbenchmark/docs/cli">SuperBench CLI</a>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">sb result diagnosis --data-file ./results-summary.jsonl --rule-file ./rule.yaml --baseline-file ./baseline.json --output-file-format excel --output-dir ${output-dir}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>After the command finished, you can find the output result file named &#x27;diagnosis_summary.xlsx&#x27; / &#x27;diagnosis_summary.json&#x27; under ${output_dir}.</p></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="input"></a>Input<a class="hash-link" href="#input" title="Direct link to heading">#</a></h2><p>The input mainly includes 3 files:</p><ul><li><p><strong>raw data</strong>: jsonl file including multiple nodes&#x27; results automatically generated by SuperBench runner.</p><p> <code>Tips</code>: this file can be found at ${output-dir}/results-summary.jsonl after each successful run.</p></li><li><p><strong>rule file</strong>: It uses YAML format and includes each metrics&#x27; rules to filter defective machines for diagnosis.</p></li><li><p><strong>baseline file</strong>: json file including the baseline values for the metrics.</p><p> <code>Tips</code>: this file for some representative machine types will be published in <a href="https://github.com/microsoft/superbench-results/tree/main" target="_blank" rel="noopener noreferrer">SuperBench Results Repo</a> with the release of Superbench.</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="rule-file"></a>rule file<a class="hash-link" href="#rule-file" title="Direct link to heading">#</a></h3><p>This section describes how to write rules in <strong>rule file</strong>.</p><p>The convention is the same with <a href="https://microsoft.github.io/superbenchmark/docs/superbench-config" target="_blank" rel="noopener noreferrer">SuperBench Config File</a>, please view it first.</p><p>Here is an overview of the rule file structure:</p><p>scheme:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">superbench</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">var</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">var_name</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dict</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">rules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">rule_name</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">function</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">criteria</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">store</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> (optional)bool</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">categories</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metrics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">benchmark_name</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/regex</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">benchmark_name</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/regex</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">...</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># SuperBench rules</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v0.4</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">superbench</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">rules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">failure-rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">function</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> value</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">criteria</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> lambda x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">categories</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Failed</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metrics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> kernel</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">launch/return_code</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mem</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bw/return_code</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> nccl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bw/return_code</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ib</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">loopback/return_code</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">rule0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Rule 0: If KernelLaunch suffers &gt; 5% downgrade, label it as defective</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">function</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> variance</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">criteria</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> lambda x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">0.05</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">categories</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> KernelLaunch</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metrics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> kernel</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">launch/event_overhead</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">\d+</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> kernel</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">launch/wall_overhead</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">\d+</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">rule1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Rule 1: If H2D_Mem_BW or D2H_Mem_BW test suffers &gt; 5% downgrade, label it as defective</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">function</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> variance</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">criteria</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> lambda x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">x&lt;</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0.05</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">categories</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Mem</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metrics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mem</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bw/H2D_Mem_BW</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">\d+</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mem</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bw/D2H_Mem_BW</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">\d+</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">rule2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Rule 2: If NCCL_BW suffers &gt; 5% downgrade, label it as defective</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">function</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> variance</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">criteria</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> lambda x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">x&lt;</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0.05</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">categories</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NCCL</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metircs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> nccl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bw/allreduce_8589934592_busbw</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">rule3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Rule 3: If GPT-2, BERT suffers &gt; 5% downgrade, label it as defective</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">function</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> variance</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">criteria</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> lambda x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">x&lt;</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">0.05</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">categories</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Model</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metrics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> bert_models/pytorch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bert</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">base/throughput_train_float(32</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">16)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> bert_models/pytorch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bert</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">large/throughput_train_float(32</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">16)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> gpt_models/pytorch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gpt</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">large/throughput_train_float(32</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">16)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">rule4</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">function</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> variance</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">criteria</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;lambda x:x&lt;-0.05&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">store</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">True</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">categories</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CNN</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metrics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> resnet_models/pytorch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">resnet.</span><span class="token important">*/throughput_train_.*</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">rule5</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">function</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> variance</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">criteria</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;lambda x:x&lt;-0.05&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">store</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">True</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">categories</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CNN</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metrics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> vgg_models/pytorch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">vgg.</span><span class="token important">*/throughput_train_.*\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">rule6</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">function</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> multi_rules</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">criteria</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;lambda label:True if label[&quot;rule4&quot;]+label[&quot;rule5&quot;]&gt;=2 else False&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">categories</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CNN</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This rule file describes the rules used for data diagnosis.</p><p>They are firstly organized by the rule name, and each rule mainly includes several elements:</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="metrics"></a><code>metrics</code><a class="hash-link" href="#metrics" title="Direct link to heading">#</a></h4><p>The list of metrics for this rule. Each metric is in the format of ${benchmark_name}/regex, you can use regex after the first &#x27;/&#x27;, but to be noticed, the benchmark name can not be a regex.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="categories"></a><code>categories</code><a class="hash-link" href="#categories" title="Direct link to heading">#</a></h4><p>The categories belong to this rule.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="criteria"></a><code>criteria</code><a class="hash-link" href="#criteria" title="Direct link to heading">#</a></h4><p>The criterion used for this rule, which indicates how to compare the data with the baseline value for each metric. The format should be a lambda function supported by Python.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="store"></a><code>store</code><a class="hash-link" href="#store" title="Direct link to heading">#</a></h4><p>True if the current rule is not used alone to filter the defective machine, but will be used by other subsequent rules. False(default) if this rule is used to label the defective machine directly.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="function"></a><code>function</code><a class="hash-link" href="#function" title="Direct link to heading">#</a></h4><p>The function used for this rule.</p><p>3 types of rules are supported currently:</p><ul><li><p><code>variance</code>: the rule is to check if the variance between raw data and baseline violates the criteria. variance = (raw data - criteria) / criteria</p><p>For example, if the &#x27;criteria&#x27; is <code>lambda x:x&gt;0.05</code>, the rule is that if the variance is larger than 5%, it should be defective.</p></li><li><p><code>value</code>: the rule is to check if the raw data violate the criteria.</p><p>For example, if the &#x27;criteria&#x27; is <code>lambda x:x&gt;0</code>, the rule is that if the raw data is larger than the 0, it should be defective.</p></li><li><p><code>multi_rules</code>: the rule is to check if the combined results of multiple previous rules and metrics violate the criteria.</p><p>For example, if the &#x27;criteria&#x27; is &#x27;lambda label:True if label[&quot;rule4&quot;]+label[&quot;rule5&quot;]&gt;=2 else False&#x27;, the rule is that if the sum of labeled metrics in rule4 and rule5 is larger than 2, it should be defective.</p></li></ul><p><code>Tips</code>: you must contain a default rule for ${benchmark_name}/return_code as the above in the example, which is used to identify failed tests.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="output"></a>Output<a class="hash-link" href="#output" title="Direct link to heading">#</a></h2><p>We support different output formats for filtering the defective machines including jsonl, excel, etc. The output includes all defective machines&#x27; information including index, failure category, failure details, and detailed metrics.</p><ul><li><p>index: the name of defective machines.</p></li><li><p>Category: categories defined in the rule.</p></li><li><p>Defective Details: all violated metrics including metric data and related rule.</p></li><li><p>${metric}: the data of the metrics defined in the rule file. If the rule is <code>variance</code>, the form of the data is variance in percentage; if the rule is <code>value</code>, the form of the data is raw data.</p></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/microsoft/superbenchmark/edit/main/website/../docs/user-tutorial/data-diagnosis.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/superbenchmark/docs/user-tutorial/system-config"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« System Config Info</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/superbenchmark/docs/user-tutorial/monitor"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Monitor Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#usage" class="table-of-contents__link">Usage</a></li><li><a href="#input" class="table-of-contents__link">Input</a><ul><li><a href="#rule-file" class="table-of-contents__link">rule file</a></li></ul></li><li><a href="#output" class="table-of-contents__link">Output</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/superbenchmark/docs/introduction">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/superbenchmark/docs/getting-started/installation">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/superbenchmark/docs/cli">API</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/microsoft/superbenchmark/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issues</a></li><li class="footer__item"><a href="https://github.com/microsoft/superbenchmark/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussion</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/superbenchmark/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/microsoft/superbenchmark" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 SuperBench. <br> Built with Docusaurus and hosted by GitHub.</div></div></div></footer></div>
<script src="/superbenchmark/assets/js/runtime~main.1636966a.js"></script>
<script src="/superbenchmark/assets/js/main.fa6a49aa.js"></script>
</body>
</html>